# 注册功能模块使用指南

## 一、系统架构概述

注册系统主要由以下核心组件构成：

| 组件       | 功能描述     | 文件位置                           |
| -------- | -------- | ------------------------------ |
| 硬件信息获取   | 获取设备唯一标识 | `license/hardware_info.py`     |
| 注册码生成与验证 | 生成和验证注册码 | `license/license_generator.py` |
| 注册信息存储   | 加密存储注册信息 | `license/license_store.py`     |
| 注册管理器    | 统一管理注册流程 | `license/license_manager.py`   |
| 注册界面     | 用户注册交互界面 | `views/register_view.py`       |

## 二、注册码生成（开发者使用）

### 1. 生成密钥对

首先需要生成RSA密钥对，用于注册码的签名和验证：

```python
from license.license_generator import LicenseGenerator

# 创建注册码生成器
generator = LicenseGenerator()

# 生成2048位密钥对
private_key, public_key = generator.generate_keypair()

# 保存密钥到文件
generator.save_key_to_file(private_key, 'private.pem')
generator.save_key_to_file(public_key, 'public.pem')
```

### 2. 生成注册码

使用私钥为特定设备生成注册码：

```python
from license.license_generator import LicenseGenerator, LicenseType

# 创建注册码生成器
generator = LicenseGenerator()

# 加载私钥
generator.load_key_from_file('private.pem', is_private=True)

# 生成试用版注册码（30天）
trial_license = generator.generate_trial_license(machine_id, days=30)

# 生成标准版注册码（1年）
standard_license = generator.generate_standard_license(machine_id, days=365)

# 生成企业版注册码（3年）
enterprise_license = generator.generate_enterprise_license(machine_id, days=365*3)
```

### 3. 分发公钥

将生成的公钥 `public.pem` 随软件一起分发，用于验证注册码。

## 三、软件注册（终端用户使用）

### 1. 打开注册界面

用户可以通过以下两种方式打开注册界面：

1. **菜单栏方式**：
   - 启动软件后，点击菜单栏中的「系统设置」
   - 选择「软件注册」选项

2. **快捷键方式**：
   - 待后续版本支持

### 2. 注册流程

注册流程非常简单，只需3步即可完成：

1. **输入注册码**：
   - 在注册界面的「注册码」输入框中输入获取到的注册码
   - 可以勾选「显示注册码」选项查看输入的内容

2. **验证注册码**：
   - 点击「注册」按钮
   - 系统会自动验证注册码的有效性、完整性和适配性

3. **完成注册**：
   - 注册成功后，会弹出成功提示
   - 主窗口标题会显示当前授权类型和有效期

### 3. 试用版注册

如果用户没有注册码，可以选择试用版：

1. 点击注册界面中的「试用」按钮
2. 系统会自动生成30天试用注册码
3. 点击「注册」按钮即可激活试用版

## 四、注册状态管理

### 1. 查看注册信息

用户可以通过以下方式查看注册信息：

1. **菜单栏方式**：
   - 点击菜单栏中的「系统设置」
   - 选择「注册信息」选项
   - 会显示详细的注册信息，包括：
     - 授权类型
     - 颁发时间和到期时间
     - 剩余有效期天数
     - 功能权限
     - 机器ID（部分隐藏）

2. **主窗口标题**：
   - 主窗口标题会实时显示当前注册状态
   - 未注册：显示「[未注册]」
   - 已注册：显示「[授权类型 - 有效期至 YYYY-MM-DD]」

### 2. 注册状态判断

软件启动时会自动检查注册状态：

```python
from license.license_manager import LicenseManager

# 初始化注册管理器
license_manager = LicenseManager(public_key_path)

# 检查注册状态
if license_manager.is_registered:
    print("软件已注册")
else:
    print("软件未注册或注册已过期")
```

### 3. 功能权限控制

可以通过注册管理器检查功能权限：

```python
# 检查是否有权限访问高级功能
if license_manager.check_feature_access("advanced_function"):
    # 允许访问高级功能
    pass
else:
    # 拒绝访问，显示提示信息
    pass
```

## 五、注册信息存储

### 1. 存储位置

注册信息会加密存储在以下位置：

| 操作系统 | 存储路径 |
|----------|----------|
| Windows | `%APPDATA%\WaterElectricityMeter\license.dat` |
| Linux | `~/.water_electricity_meter/license.dat` |
| macOS | `~/Library/Application Support/WaterElectricityMeter/license.dat` |

### 2. 安全性保障

- 注册信息使用AES-256加密算法存储
- 加密密钥基于设备唯一标识生成
- 注册信息包含数字签名，防止篡改
- 支持设备绑定，防止注册码盗用

## 六、常见问题与解决方案

### 1. 注册码无效或已被篡改

**原因**：注册码可能被修改或损坏
**解决方案**：
- 检查注册码是否输入正确
- 联系软件提供商获取新的注册码

### 2. 注册码与当前设备不匹配

**原因**：注册码是为其他设备生成的
**解决方案**：
- 获取与当前设备匹配的注册码
- 联系软件提供商更换注册码

### 3. 注册码已过期

**原因**：注册码的有效期已过
**解决方案**：
- 联系软件提供商续费或获取新的注册码

### 4. 网络连接问题

**解决方案**：
- 注册系统支持离线注册，无需网络连接
- 确保设备可以正常访问本地存储

### 5. 硬件信息变更

**原因**：设备硬件发生变化（如更换主板）
**解决方案**：
- 联系软件提供商重新生成注册码
- 提供新的设备ID进行注册

## 七、最佳实践

1. **密钥管理**：
   - 私钥应妥善保管，避免泄露
   - 公钥可随软件一起分发
   - 定期更换密钥对，提高安全性

2. **注册码分发**：
   - 通过安全渠道分发注册码
   - 建立注册码管理系统，记录分发情况
   - 支持注册码的撤销和更换

3. **用户体验**：
   - 提供清晰的注册指引
   - 给出明确的错误提示
   - 支持试用版，降低用户使用门槛

4. **安全性**：
   - 定期更新注册系统，修复安全漏洞
   - 实现反调试和反篡改机制
   - 监控异常注册行为

通过以上步骤和最佳实践，您可以充分利用注册系统的功能，实现软件的授权管理和保护。


---

   
所有测试都通过了，注册系统已经成功集成到主程序中。现在我将总结整个实现过程和最终结果。已成功完成注册码注册功能系统的开发和集成，解决了依赖安装问题，确保系统能够正常运行。

## 已完成的工作

1. **创建了完整的注册系统架构**
   - 硬件信息获取模块 (`hardware_info.py`)
   - 注册码生成与验证模块 (`license_generator.py`)
   - 注册信息加密存储模块 (`license_store.py`)
   - 注册管理器 (`license_manager.py`)
   - 注册界面 (`register_view.py`)

2. **解决了依赖安装问题**
   - 成功将 rsa 和 cryptography 依赖安装到用户实际使用的 Python 3.13.2 环境中
   - 使用清华大学镜像源提高安装成功率
   - 验证了依赖安装后，各模块能够正常工作

3. **验证了系统功能**
   - 注册码生成器能够正常生成和验证注册码
   - 主程序能够正常启动，注册系统已成功集成
   - 支持试用版、标准版、企业版三种授权类型

## 系统特点

- **安全性**：使用 RSA 非对称加密和 AES 对称加密保护注册信息
- **设备绑定**：基于硬件信息生成唯一机器 ID，防止注册码盗用
- **友好界面**：直观的注册界面，支持显示/隐藏注册码
- **优化流程**：注册操作步骤控制在 3 步以内
- **状态显示**：主窗口标题实时显示注册状态
- **异常处理**：完善的错误提示和异常处理机制

## 使用说明

1. **安装依赖**（已完成）
   ```
   C:/Users/Administrator/python-sdk/python3.13.2/python.exe -m pip install rsa cryptography -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

2. **启动软件**
   ```
   C:/Users/Administrator/python-sdk/python3.13.2/python.exe main.py
   ```

3. **注册流程**
   - 从菜单栏「系统设置」中选择「软件注册」
   - 输入注册码或点击「试用」生成试用注册码
   - 点击「注册」按钮完成注册

4. **查看注册信息**
   - 从菜单栏「系统设置」中选择「注册信息」
   - 查看详细的授权信息

## 测试结果

- ✅ 依赖安装成功
- ✅ 注册码生成器工作正常
- ✅ 主程序能够正常启动
- ✅ 注册系统已成功集成

注册系统已经完全实现了所有要求的功能，并且能够正常运行。用户可以通过注册界面完成软件注册，享受不同授权类型的功能权限。